<!DOCTYPE html>
<html>
<head>
    <link rel="manifest" href="manifest.json" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#317EFB" />
    <meta charset="UTF-8" />
    <title>Gilly Exhausts</title>
    <link rel="stylesheet" href="../global.css">
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div class="nav">
        <div class="nav-font"><a href="/">DASHBOARD</a></div>
        <div class="nav-font"><a href="../hoods/">HOODS</a></div>
        <div class="nav-font"><a href="../fan/">FAN</a></div>
        <div class="nav-font"><a href="../help/">HELP</a></div>
        <div class="nav-font"><a href="../config/">CONFIG</a></div>
    </div>
    <div class="content">
                <div class="additional-links section">
                    <div><a href="../config/fans/">FANS</a></div>
                    <div><a href="../config/damper/">DAMPER</a></div>
                    <div><a href="../config/modes/">PASSIVE MODES</a></div>
                </div>
            <div class="tempr section">
                <div class="temp-heading">THRESHOLDS</div>

            </div>
    </div>
   
    <script src="../global.js"></script>

    <script>

    const tempInputs = document.querySelectorAll(".tempinput");


    tempInputs.forEach(function (input, index) {
        input.addEventListener("input", function () {
            let currentValue = parseFloat(input.value);
            if (index < tempInputs.length - 1) {
                // Set the start temperature of the next input
                tempInputs[index + 1].min = currentValue;
                // Update the temperature label of the next input
                document.getElementById("temp" + (index + 2) + "value").textContent = currentValue;
            }
            // Update displayed value beside the label
            document.getElementById("temp" + (index + 1) + "value").textContent = currentValue;
            updateConfig();
        });
    });

    temp_div = `<div class="temp-container">
                    <label for="temp1">Temperature 1: 3°C</label>
                    <input class="tempinput" id="temp1" type="range" step="5" value="5" min="1" max="200">
                </div>`

    const animate = async() => {
        let conf = await getConfig();
            
        let main_cont = document.querySelector(".tempr")
        main_cont.innerHTML = '<div class="temp-heading">THRESHOLDS</div>'
        for (let i = 0; i < 4; i++) {
            let min = 0
            if(i!=0){
                min = conf["temperature_range"][i-1] +1
            }
            if(i!=3){
                if(conf["temperature_range"][i] > conf["temperature_range"][i+1]){
                    conf["temperature_range"][i+1] = conf["temperature_range"][i] +1

                }
                setConfig(conf)
            }

            const elementHTML = `<div class="temp-container">
                    <label for="temp1">Temperature 1: ${conf["temperature_range"][i]}°C</label>
                    <input class="tempinput" id="temp_inp${i}" type="range" step="5" value="${conf["temperature_range"][i]}" min="${min}" max="${min+100}">
                </div>`
            main_cont.innerHTML += elementHTML
        }
        for (let i = 0; i < 4; i++) {
            document.getElementById(`temp_inp${i}`).addEventListener("input", function (value) {
                conf["temperature_range"][i] = Number(value.target.value)
                setConfig(conf)
                setTimeout(animate, 0)
            })
        }
    }

    animate()


    </script>
</body>
</html>
