<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#317EFB" />
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="../../global.css">
    <link rel="stylesheet" href="style.css">
    <title>config</title>
</head>
<body>
  <div class="nav">
    <div class="nav-font"><a href="../index.html">BACK</a></div>
    <div class="nav-font"><button onclick="showPage('default')">Default</button></div>
    <div class="nav-font"><button onclick="showPage('1')">MODE1</button></div>
    <div class="nav-font"><button onclick="showPage('2')">MODE2</button></div>
    <div class="nav-font"><button onclick="showPage('3')">MODE3</button></div>
  </div>

  <div class="content">
    <div class="heading"></div>
    <div class="left">
        <div class="fan_area"></div>
    </div>
    <div class="right">
        <div class="damper_area"></div>
    </div>
  </div>
  <script src="../../global.js"></script>
  
  <script>
    // Pull this app state and global config
    let conf = {
        "passive_modes": {
            "default": {"fans": {"exhaust": 10, "intake": 5 }, "dampers" : [25, 25, 25, 25 ]},
            "1": {"fans": {"exhaust": 40, "intake": 10 }, "dampers" : [35, 25, 35, 25 ]},
            "2": {"fans": {"exhaust": 50, "intake": 10 }, "dampers" : [35, 35, 35, 35 ]},
            "3": {"fans": {"exhaust": 70, "intake": 20 }, "dampers" : [45, 45, 45, 45 ]}
        }
    }

    const heading = document.querySelector('.heading');
    const fan_area = document.querySelector('.fan_area');
    const damper_area = document.querySelector('.damper_area');

    function showPage(mode) {
        const modeConfig = conf.passive_modes[mode];
        if (!modeConfig) return;

        heading.innerText = `Customize: Mode ${mode}`;

        // Clear existing content
        fan_area.innerHTML = '';
        damper_area.innerHTML = '';

        // Populate fan area
        const fans = Object.entries(modeConfig.fans);
        for (let i = 0; i < fans.length; i++) {
            let div = document.createElement('div');
            div.classList.add('fan');
            
            let label_div = document.createElement('div');
            label_div.classList.add('label');
            label_div.innerText = `${fans[i][0]}:`;
            div.appendChild(label_div);

            let input = document.createElement('input');
            input.type = 'range';
            input.min = '0';
            input.max = '100';
            input.value = fans[i][1];
            input.classList.add('fan_input');
            input.classList.add(fans[i][0]);
            input.addEventListener('input', (e) => {
                modeConfig.fans[e.target.classList[1]] = parseInt(e.target.value, 10);
                e.target.nextElementSibling.innerText = e.target.value;
                console.log(conf);  // Log the updated conf object
            });
            div.appendChild(input);

            let value_display = document.createElement('span');
            value_display.classList.add('value_display');
            value_display.innerText = fans[i][1];
            div.appendChild(value_display);

            fan_area.appendChild(div);
        }

        // Populate damper area
        let damperHeading = document.createElement('div');
        damperHeading.classList.add('damper_heading');
        damperHeading.innerText = 'Dampers :';
        damper_area.appendChild(damperHeading);

        for (let i = 0; i < modeConfig.dampers.length; i++) {
            let input_div = document.createElement('div');
            input_div.classList.add('damper');

            let input = document.createElement('input');
            input.type = 'range';
            input.min = '0';
            input.max = '100';
            input.value = modeConfig.dampers[i];
            input.classList.add('damper_input');
            input.classList.add(`damper${i}`);
            input.addEventListener('input', (e) => {
                modeConfig.dampers[i] = parseInt(e.target.value, 10);
                e.target.nextElementSibling.innerText = e.target.value;
                console.log(conf);  // Log the updated conf object
            });
            input_div.appendChild(input);

            let value_display = document.createElement('span');
            value_display.classList.add('value_display');
            value_display.innerText = modeConfig.dampers[i];
            input_div.appendChild(value_display);

            damper_area.appendChild(input_div);
        }
    }

    // Initialize with default mode
    showPage('default');
  </script>
</body>
</html>
