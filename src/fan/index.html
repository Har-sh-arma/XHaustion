<!DOCTYPE html>
<html>
  <head>
    <link rel="manifest" href="../manifest.json" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#317EFB" />
    <meta charset="UTF-8" />
    <title>FAN</title>
    <link rel="stylesheet" href="../global.css">
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="nav">
      <div class="nav-font"><a href="/">DASHBOARD</a></div>
      <div class="nav-font"><a href="../hoods/">HOODS</a></div>
      <div class="nav-font"><a href="../fan/">FAN</a></div>
      <div class="nav-font"><a href="../help/">HELP</a></div>
      <div class="nav-font"><a href="../config/">CONFIG</a></div>
    </div>

    <div class="content">

    </div>
    <script src="../global.js"></script>

    <script>
        let config = {}
        let sys_state = {}
        
        let data = {data:[
          {"fan_speed": 2500, "air_flow": 250, "duct_temperature":40, "duct_pressure":1}, 
          {"fan_speed": 3000, "air_flow": 300, "duct_temperature":50, "duct_pressure":1.4}
        ]}


        const animate = async() => {
            config = await getConfig();
            sys_state = await getSystemState();
            // console.log(sys_state);

            document.querySelector('.content').innerHTML = '';
            let exhaust = makeSection("exhaust", sys_state["exhaust"], config["exhaust_max_rpm"])
            document.querySelector('.content').innerHTML = exhaust

            if (config["has_intake"]) {
              let intake = makeSection("intake", sys_state["intake"], config["intake_max_rpm"])
              document.querySelector('.content').innerHTML += intake
            }  

            document.querySelectorAll("input").forEach(el => {
              el.addEventListener("input", () => {
                sys_state[el.className] = el.value
                sys_state["override"]["fans"][el.className] = 1
                console.log(sys_state)
                setSystemState(sys_state).then(() => { requestAnimationFrame(animate) })
              })
            })
        }

        const makeSection =(fan_name, fan_speed, max_rpm)=>{
          return `<div class="section"><div class="heading">${fan_name.toUpperCase()}</div><div class="stats"><div class="stat"> 250 l / min</div><div class="stat"> 40°C</div><div class="stat"> 1Pa</div></div><div class="speed"><div class="speed_val">Fan Speed: ${max_rpm* (fan_speed/100)}Rpm</div><input class="${fan_name}" type="range" min="0" max="100" step ="1" value="${fan_speed}" class="speed_slider"></div></div>`
        }

        animate()

        // let exhaust = document.createElement("div")
        // exhaust.classList.add("section")
        // let heading = document.createElement("div")
        //  heading.classList.add("heading")
        //         heading.innerText = "INTAKE"
        // let stats = document.createElement("div")
        // stats.classList.add("stats")
        // let air_flow = document.createElement("div")
        // air_flow.classList.add("stat")
        // air_flow.innerText = " " + data["data"][0]["air_flow"]+ " l / min"
        // let duct_temperature = document.createElement("div")
        // duct_temperature.classList.add("stat")
        // duct_temperature.innerText = " " + data["data"][0]["duct_temperature"]+ "°C"
        // let duct_pressure = document.createElement("div")
        // duct_pressure.classList.add("stat")
        // duct_pressure.innerText = " " + data["data"][0]["duct_pressure"]+ "Pa"
        // stats.appendChild(air_flow)
        // stats.appendChild(duct_temperature)
        // stats.appendChild(duct_pressure)

        // let speed = document.createElement("div")
        // speed.classList.add("speed")
        // let speed_val = document.createElement("div")
        // speed_val.classList.add("speed_val")
        // speed_val.innerText = "Fan Speed: " + data["data"][0]["fan_speed"]+"Rpm"
        // speed.appendChild(speed_val)
        // let speed_slider = document.createElement("input")
        // speed_slider.type = "range"
        // speed_slider.min = "0"
        // speed_slider.max = "10000"
        // speed_slider.value = data["data"][0]["fan_speed"]
        // speed_slider.classList.add("speed_slider")
        // speed_slider.addEventListener("input", (e) => {
        //   speed_val.innerText = "Fan Speed: " + e.target.value
        // })

        // speed.appendChild(speed_slider)
        // exhaust.appendChild(heading)
        // exhaust.appendChild(stats)
        // exhaust.appendChild(speed)

        // // let intake = document.createElement("div")
        // // if (config["has_intake"] === "True"){
        // //         intake.classList.add("section")
        // //         let heading = document.createElement("div")
        // //         heading.classList.add("heading")
        // //         heading.innerText = "INTAKE"
        // //         let stats = document.createElement("div")
        // //         stats.classList.add("stats")
        // //         let air_flow = document.createElement("div")
        // //         air_flow.classList.add("stat")
        // //         air_flow.innerText = " " + data["data"][1]["air_flow"]+ " l / min"
        // //         let duct_temperature = document.createElement("div")
        // //         duct_temperature.classList.add("stat")
        // //         duct_temperature.innerText = "" + data["data"][1]["duct_temperature"]+ "°C"
        // //         let duct_pressure = document.createElement("div")
        // //         duct_pressure.classList.add("stat")
        // //         duct_pressure.innerText = " " + data["data"][1]["duct_pressure"]+ "Pa"
        // //         stats.appendChild(air_flow)
        // //         stats.appendChild(duct_temperature)
        // //         stats.appendChild(duct_pressure)

        // //         let speed = document.createElement("div")
        // //         speed.classList.add("speed")
        // //         let speed_val = document.createElement("div")
        // //         speed_val.classList.add("speed_val")
        // //         speed_val.innerText = "Fan Speed: " + data["data"][1]["fan_speed"]+"Rpm"
        // //         speed.appendChild(speed_val)
        // //         let speed_slider = document.createElement("input")
        // //         speed_slider.type = "range"
        // //         speed_slider.min = "0"
        // //         speed_slider.max = "10000"
        // //         speed_slider.value = data["data"][1]["fan_speed"]
        // //         speed_slider.classList.add("speed_slider")
        // //         speed_slider.addEventListener("input", (e) => {
        // //           speed_val.innerText = "Fan Speed: " + e.target.value 
        // //         })

        // //         speed.appendChild(speed_slider)
        // //         intake.appendChild(heading)
        // //         intake.appendChild(stats)
        // //         intake.appendChild(speed)

        // // }

        // let content = document.getElementsByClassName("content")
        // content[0].appendChild(exhaust)
        // // content[0].appendChild(intake)




    </script>
        
    </body>


</html>