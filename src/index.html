<!DOCTYPE html>
<html>
  <head>
    <link rel="manifest" href="manifest.json" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#317EFB" />
    <meta charset="UTF-8" />
    <title>Hello World!</title>
    <link rel="stylesheet" href="global.css">
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="nav">
      <div class="nav-font"><a href="/">DASHBOARD</a></div>
      <div class="nav-font"><a href="hoods/">HOODS</a></div>
      <div class="nav-font"><a href="fan/">FAN</a></div>
      <div class="nav-font"><a href="help/">HELP</a></div>
      <div class="nav-font"><a href="config/">CONFIG</a></div>
    </div>
  
    <div class="content">
      <div class="air-flow">
        <div class="con">
          <div class="arrow"></div>
          <div class="speedometer-value">0</div>
        </div>
      </div>
      <div class="fan-speed">
        <div class="con">
          <div class="arrow"></div>
          <div class="speedometer-value">0</div>
        </div>
      </div>
      <div class="dampers">
        <div class="con">
          <div class="arrow"></div>
          <div class="speedometer-value">0</div>
        </div>
      </div>
    </div>
  
    <div class="modes">
      <div class="mode-label">MODES: </div>
      <div class="mode-list">
        <!-- <div>Default</div>
        <div>MODE1</div>
        <div>MODE2</div>
        <div>MODE3</div> -->
        </div>
      </div>
    </div>
  
    <div class="footer">
      <div class="status">
        <div class="status-label"> PASSIVE </div>
      </div>
      <div class="start">
        <div class="start-label">START</div>
      </div>
    </div>
  <script src="global.js"></script>
   <script>



    let selected_fan = "exhaust"
    let selected_damper = 0
    let selected_passive_mode = "default"
    let selected_mode = "passive"
    let conf = {};
    let sys_state = {}
    // init
    async function init() {
      conf = await getConfig();
      sys_state = await getSystemState();
    }
    init().then(
      ()=>{
        window.requestAnimationFrame(animate)
      }
    )

    const animate = () => {
      window.requestAnimationFrame(animate)
      // setDialRotation(".air-flow", sys_state["air_flow"], sys_state["air_flow"])
      setDialRotation(".fan-speed", sys_state[selected_fan], sys_state[selected_fan]+"Rpm")
      setDialRotation(".dampers", sys_state["dampers"][selected_damper]*2, sys_state["dampers"][selected_damper])
    }
    



    function setDialRotation(selector, value, display_value) {
      const dial = document.querySelector(selector + ' .arrow');
      const degree =  value;
      dial.style.transform = `translateX(-50%) translateY(24vh) rotate(${degree}deg)`;
      const speedometerValue = document.querySelector(selector + ' .speedometer-value');
      speedometerValue.textContent = display_value; // Update value
    }




  </script>
  </body>
</html>
