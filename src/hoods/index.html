<!DOCTYPE html>
<html>
  <head>
    <link rel="manifest" href="../manifest.json" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#317EFB" />
    <meta charset="UTF-8" />
    <title>Hello World!</title>
    <link rel="stylesheet" href="../global.css">
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="nav">
      <div class="nav-font"><a href="/">DASHBOARD</a></div>
      <div class="nav-font"><a href="../hoods/">HOODS</a></div>
      <div class="nav-font"><a href="../fan/">FAN</a></div>
      <div class="nav-font"><a href="../help/">HELP</a></div>
      <div class="nav-font"><a href="../config/">CONFIG</a></div>
    </div>

    <div class="content">
        <div class="heading row">
            <div>Name</div>
            <div>Air-flow [m^3/min]</div>
            <div>Temperature [째C]</div>
            <div>Damper angle [째]</div>
        </div>

    </div>
    <script src="../global.js"></script>

    <script>

        let conf =  {
    "pwm_pins": [12, 32],
    "CS_PIN": 38,
    "SCK_PIN":40,
    "temperature_pins": [37, 35, 33, 31, 29],
    "exhaust_max_rpm": 5000,
    "intake_max_rpm": 3000,
    "has_intake": 1,
    "num_dampers": 4,
    "damper_step":4,
    "fan_step": 4,
    "temperature_range": [
        40,
        70,
        100,
        150
    ],
    "passive_modes": {
        "default": {
            "fans": {
                "exhaust": 10,
                "intake": 5
            },
            "dampers": [
                25,
                25,
                25,
                25
            ]
        },
        "1": {
            "fans": {
                "exhaust": 40,
                "intake": 10
            },
            "dampers": [
                35,
                25,
                35,
                25
            ]
        },
        "2": {
            "fans": {
                "exhaust": 50,
                "intake": 10
            },
            "dampers": [
                35,
                35,
                35,
                35
            ]
        },
        "3": {
            "fans": {
                "exhaust": 70,
                "intake": 20
            },
            "dampers": [
                45,
                45,
                45,
                45
            ]
        }
    },
    "fan_power_scaling_for_hoods": [
        [
            40,
            60,
            80,
            100
        ],
        [
            30,
            50,
            70,
            90
        ],
        [
            20,
            40,
            50,
            80
        ],
        [
            10,
            30,
            50,
            70
        ]
    ],
    "damper_angles": [
        25,
        45,
        60,
        90
    ]
}

        let sys_state = {
                "mode": "passive",
                "passive_mode": "default",
                "temperatures": [0, 0, 0, 0],
                "dampers": [0, 0, 0, 0],
                "air_flow": 0
            }
        
        const animate = async()=>{
            // conf = await getConfig();
            // sys_state = await getSystemState();
            
          

            document.querySelector('.content').innerHTML = '';
            document.querySelector('.content').innerHTML = '<div class="heading row"><div>Name</div><div><p>Air-flow [m<sup>3</sup>/min]</p></div><div>Temperature [째C]</div><div>Damper angle [째]</div></div>';

            for(let i = 0; i < conf.num_dampers; i++){
                let div = document.createElement('div')
                div.classList.add('row')
                let name = document.createElement('div')
                name.innerText = i
                let airflow = document.createElement('div')
                // airflow.innerText = sys_state["air_flow"]
                let temp = document.createElement('div')
                temp.innerText = sys_state["temperatures"][i]
                let damper = document.createElement('div')
                damper.classList.add('damper')
                damper.innerHTML = `<div class="button dec">-</div> ${sys_state["dampers"][i]}<div class="button inc">+</div>`
                damper.addEventListener('click', (e)=>{
                    if(e.target.classList.contains('dec')){
                        if(sys_state["dampers"][i] > 0){
                            sys_state["dampers"][i] -= 90/conf["damper_step"]
                        }
                    }else if(e.target.classList.contains('inc')){
                        if(sys_state["dampers"][i] < 90){
                            sys_state["dampers"][i] += 90/conf["damper_step"]
                        }
                    }
                    // setSystemState(sys_state).then(() => { requestAnimationFrame(animate) })
                })
                div.appendChild(name)
                div.appendChild(airflow)
                div.appendChild(temp)
                div.appendChild(damper)
                document.querySelector('.content').appendChild(div)

                // update state using set state
            }


        }
        animate()

        setInterval(animate, 1000);



    </script>
        
    </body>


</html>